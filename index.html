<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ðŸ’¥ zettelkasten.shop ðŸ’¥</title>
  <link rel="apple-touch-icon" sizes="180x180" href="images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon/favicon-16x16.png">
  <link rel="manifest" href="images/favicon/site.webmanifest">
  <link rel="icon" type="image/png" sizes="192x192" href="images/favicon/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="images/favicon/android-chrome-512x512.png">
  <meta name="theme-color" content="#402554">
  <link href="https://fonts.googleapis.com/css2?family=PT+Mono&family=PT+Sans+Pro&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    :root {
      --primary-bg: #402554;
      --header-color: #E6B7FF;
      --paragraph-color: #ffffff;
      --border-color: #C51BFE;
    }
    a {
      color: var(--border-color);
    }
    body {
      font-family: 'PT Sans Pro', sans-serif;
      margin: 0;
      background-color: var(--primary-bg);
      color: var(--paragraph-color);
      font-size: 16px;
      line-height: 1.6;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    #menu {
      position: sticky;
      top: 0;
      z-index: 9999;
      background: var(--primary-bg);
      padding: 10px 20px;
      font-family: 'PT Mono', monospace;
    }
    #menu-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--border-color);
      cursor: pointer;
      display: block;
      margin: 0 auto;
    }
    #dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      height: 90vh;
      width: 100%;
      background: var(--primary-bg);
      border: 2px solid var(--border-color);
      box-sizing: border-box;
      padding: 10px;
      transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
      max-height: 0;
      overflow-y: auto;
      opacity: 0;
      pointer-events: none;
      z-index: 1000;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    #dropdown-menu::-webkit-scrollbar {
      width: 0;
      display: none;
    }
    #dropdown-menu.show {
      max-height: 700px;
      opacity: 1;
      pointer-events: auto;
    }
    #dropdown-menu a {
      text-decoration: none;
      color: var(--paragraph-color);
      font-weight: bold;
      margin-right: 10px;
    }
    #dropdown-menu input {
      width: 100%;
      padding: 8px;
      border: 2px solid var(--border-color);
      margin-top: 10px;
      background: transparent;
      color: var(--paragraph-color);
    }
    #posts-container {
      margin-top: 10px;
      overflow-y: auto;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    #posts-container::-webkit-scrollbar {
      width: 0;
      display: none;
    }
    .content {
      padding: 20px;
    }
    .content h1,
    .content h2,
    .content h3 {
      font-family: 'PT Mono', monospace;
      color: var(--header-color);
      margin-top: 1em;
      margin-bottom: 0.5em;
      line-height: 1.3;
    }
    .content p,
    .content ul,
    .content ol,
    .content li {
      font-family: 'PT Sans Pro', sans-serif;
      margin-bottom: 1.5em;
      max-width: 65ch;
      margin-left: auto;
      margin-right: auto;
    }
    .content img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 1em auto;
    }
    .content h1::after {
      content: "";
      display: block;
      width: 100%;
      height: 4px;
      background-color: var(--border-color);
      margin-top: 10px;
    }
    .card {
      background: transparent;
      border: 2px solid var(--border-color);
      margin-bottom: 15px;
      padding: 10px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .card:hover {
      background-color: rgba(197, 27, 254, 0.1);
    }
    .card .title {
      font-size: 1.2em;
      font-weight: bold;
      font-family: 'PT Mono', monospace;
      color: var(--header-color);
    }
    .card .date {
      font-size: 0.9em;
      font-family: 'PT Mono', monospace;
      color: var(--paragraph-color);
    }
    @media (max-width: 600px) {
      .container {
        max-width: 90%;
      }
      #dropdown-menu {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <nav id="menu">
      <button id="menu-toggle"><i data-feather="menu"></i></button>
      <div id="dropdown-menu">
        <!-- Updated to go directly to zettelkasten.shop -->
        <a href="https://zettelkasten.shop" target="_blank">Zettelkasten.Shop</a>
        <a>|</a>
        <!-- This now loads the default content text -->
        <a href="#" id="about-menu">About this blog</a>
        <input type="text" id="search-box" placeholder="Search microblogs...">
        <div id="posts-container"></div>
      </div>
    </nav>
    <div class="content" id="content">
      <div class="post-wrapper" id="post-wrapper">
        <h1>A Blog for Zettelkasten.Shop</h1>
        <p>
          This microblog is for beginner and veteran students, professionals, and entrepreneurs who want to become the best version of themselves.
          The goal is to inspire growth and learningâ€”ideally by exploring the material I write about, reading it yourself, and adding key insights to your own Zettelkasten.
          If you're not into reading for skill growth and knowledge, this blog isn't for you.
          I'm currently on my path to becoming an entrepreneur, and this blog is dedicated to the skills that will get me there, as well as how I'm applying them to move forward.
          Each post follows a simple format: a thought-provoking quote, the author or speaker, the source where I found it, and a concise explanationâ€”at most a nine-sentence paragraph.
          To navigate, tap the hamburger menu to browse posts, click on one to read, and see if you learn something new.
          If youâ€™re looking for a more structured approach to expanding your knowledge, check out
          <a href="https://theclassics.school" target="_blank">The Classics School</a> for self-guided, week-by-week lessons based on classic literature.
        </p>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    function formatDate(e) {
      return new Date(e.replace(/-/g,"/")).toLocaleDateString(undefined,{
        year:"numeric",
        month:"short",
        day:"numeric"
      });
    }
    function embedYouTubeVideos(htmlContent) {
      const tempDiv = document.createElement("div");
      tempDiv.innerHTML = htmlContent;
      const youtubeRegex = /^(https?:\/\/(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/))([A-Za-z0-9_-]{11})(?:\S*)$/;
      tempDiv.querySelectorAll("p").forEach(p => {
        const text = p.textContent.trim();
        const match = text.match(youtubeRegex);
        if (match) {
          const videoId = match[2];
          const iframeHTML = 
            '<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: black;">' +
            '<iframe src="https://www.youtube.com/embed/' + videoId + 
            '" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" ' +
            'frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; ' +
            'gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></div>';
          p.outerHTML = iframeHTML;
        }
      });
      return tempDiv.innerHTML;
    }
    async function loadMarkdown(url) {
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        const text = await response.text();
        history.pushState(null,"","?post="+encodeURIComponent(url));
        const contentDiv = document.getElementById("content");
        let html = marked.parse(text);
        html = embedYouTubeVideos(html);
        contentDiv.innerHTML = '<div class="post-wrapper">' + html + '</div>';
      } catch (error) {
        document.getElementById("content").innerHTML =
          '<div class="post-wrapper"><p>Error loading microblog.</p></div>';
      }
    }
    async function loadMarkdownExternal(url) {
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        const text = await response.text();
        let html = marked.parse(text);
        html = embedYouTubeVideos(html);
        document.getElementById("content").innerHTML =
          '<div class="post-wrapper">' + html + '</div>';
      } catch (error) {
        document.getElementById("content").innerHTML =
          '<div class="post-wrapper"><p>Error loading content.</p></div>';
      }
    }
    function renderPosts(posts) {
      const postsContainer = document.getElementById("posts-container");
      postsContainer.innerHTML = "";
      posts.forEach(post => {
        const card = document.createElement("div");
        card.className = "card";
        
        const titleEl = document.createElement("div");
        titleEl.className = "title";
        titleEl.textContent = post.title;
        
        const dateEl = document.createElement("div");
        dateEl.className = "date";
        dateEl.textContent = formatDate(post.date_published);
        
        card.appendChild(titleEl);
        card.appendChild(dateEl);
        
        // Close the menu after selecting a post
        card.addEventListener("click", () => {
          loadMarkdown(post.link);
          document.getElementById("dropdown-menu").classList.remove("show");
        });
        
        postsContainer.appendChild(card);
      });
    }
    let validPostsGlobal = [];
    const defaultContent = '<div class="post-wrapper"><h1>blog.zettelkasten.shop</h1>' +
  '<p>This microblog is for beginner and veteran students, professionals, and entrepreneurs who want to become the best version of themselves. The goal is to inspire growth and learningâ€”ideally by exploring the material I write about, reading it yourself, and adding key insights to your own Zettelkasten. If you\'re not into reading for skill growth and knowledge, this blog isn\'t for you. I\'m currently on my path to becoming an entrepreneur, and this blog is dedicated to the skills that will get me there, as well as how I\'m applying them to move forward. Each post follows a simple format: a thought-provoking quote, the author or speaker, the source where I found it, and a concise explanationâ€”at most a nine-sentence paragraph. To navigate, tap the hamburger menu to browse posts, click on one to read, and see if you learn something new. If youâ€™re looking for a more structured approach to expanding your knowledge, check out <a href="https://theclassics.school" target="_blank">The Classics School</a> for self-guided, week-by-week lessons based on classic literature.</p></div>';

    async function loadPosts() {
      try {
        const response = await fetch("posts.json");
        if (!response.ok) {
          throw new Error("Failed to fetch posts.json");
        }
        const data = await response.json();
        
        // Check which post links are valid
        const checkedPosts = await Promise.all(
          data.map(async post => {
            try {
              const res = await fetch(post.link, { method: "HEAD" });
              if (!res.ok) throw new Error("Status " + res.status);
              return post;
            } catch (err) {
              return null;
            }
          })
        );
        
        const validPosts = checkedPosts.filter(p => p !== null);
        validPosts.sort((a, b) => new Date(b.date_published) - new Date(a.date_published));
        validPostsGlobal = validPosts;
        renderPosts(validPostsGlobal);
        
        // If there's a post in the query param, load it
        const params = new URLSearchParams(window.location.search);
        const postParam = params.get("post");
        if (postParam) {
          const foundPost = validPostsGlobal.find(p => p.link === postParam);
          if (foundPost) {
            loadMarkdown(foundPost.link);
          }
        }
      } catch (error) {
        document.getElementById("posts-container").innerHTML =
          "<p>Error loading microblogs.</p>";
      }
    }
    document.addEventListener("DOMContentLoaded", function() {
      loadPosts();
      feather.replace();
    });
    document.getElementById("search-box").addEventListener("input", function(e) {
      const searchTerm = e.target.value.toLowerCase();
      const filtered = validPostsGlobal.filter(post =>
        post.title.toLowerCase().includes(searchTerm)
      );
      renderPosts(filtered);
    });
    
    // "About this blog" -> defaultContent
    document.getElementById("about-menu").addEventListener("click", e => {
      e.preventDefault();
      document.getElementById("content").innerHTML = defaultContent;
      history.pushState(null,"",window.location.pathname);
      document.getElementById("dropdown-menu").classList.remove("show");
    });
    
    document.getElementById("menu-toggle").addEventListener("click", function() {
      document.getElementById("dropdown-menu").classList.toggle("show");
    });
    document.addEventListener("click", function(e) {
      const dropdownMenu = document.getElementById("dropdown-menu");
      const menuToggle = document.getElementById("menu-toggle");
      if (!dropdownMenu.contains(e.target) && !menuToggle.contains(e.target)) {
        dropdownMenu.classList.remove("show");
      }
    });
  </script>
</body>
</html>
